<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PwGen</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2A3850">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }
    </script>
</head>

<body>
    <div class="gradient"></div>
    <div class="container">
        <h1 id="header1">Generate a Secure Password</h1>
        <div id="passwordOptions">
            <div id="sliderContainer">
                <label for="lengthSlider">Length: <span id="lengthValue">12</span></label>
                <input type="range" id="lengthSlider" name="length" min="1" max="64" value="12">
            </div>
            <div>
                <input type="checkbox" id="includeUppercase" checked>
                <label for="includeUppercase">Include Uppercase Letters</label>
            </div>
            <div>
                <input type="checkbox" id="includeDigits" checked>
                <label for="includeDigits">Include Digits</label>
            </div>
            <div>
                <input type="checkbox" id="includeSpecial" checked>
                <label for="includeSpecial">Include Special Characters</label>
            </div>
            <div>
                <input type="checkbox" id="passphraseToggle">
                <label for="passphraseToggle">Generate Passphrase</label>
            </div>
            <div id="passphraseOptions" style="display: none;">
                <div>
                    <input type="checkbox" id="capitalizeWords">
                    <label for="capitalizeWords">Capitalize Words</label>
                </div>
                <div id="wordCountContainer">
                    <label for="wordCountSlider">Word Count: <span id="wordCountValue">4</span></label>
                    <input type="range" id="wordCountSlider" name="wordCount" min="2" max="10" value="4">
                </div>
            </div>
        </div>
        <div class="password-container" style="display: flex;">
            <input type="text" id="password" readonly>
            <button onclick="copyPassword()">Copy</button>
        </div>
        <footer>
            <p>Simple password generator made by <a href="https://github.com/jocxfin" target="_blank" rel="noopener noreferrer">jocxFIN</a></p>
        </footer>
    </div>
    
    <script>
        const lengthSlider = document.getElementById('lengthSlider');
        const lengthValue = document.getElementById('lengthValue');
        const includeUppercase = document.getElementById('includeUppercase');
        const includeDigits = document.getElementById('includeDigits');
        const includeSpecial = document.getElementById('includeSpecial');
        const passphraseToggle = document.getElementById('passphraseToggle');
        const passphraseOptions = document.getElementById('passphraseOptions');
        const capitalizeWords = document.getElementById('capitalizeWords');
        const wordCountSlider = document.getElementById('wordCountSlider');
        const wordCountValue = document.getElementById('wordCountValue');
        const passwordInput = document.getElementById('password');

        passphraseToggle.onchange = function () {
            if (this.checked) {
                document.getElementById('passwordOptions').style.display = 'none';
                document.getElementById('passphraseOptions').style.display = 'block';
            } else {
                document.getElementById('passwordOptions').style.display = 'block';
                document.getElementById('passphraseOptions').style.display = 'none';
            }
            generatePassword();
        };


        lengthSlider.oninput = function () {
            lengthValue.textContent = this.value;
            generatePassword();
        };

        wordCountSlider.oninput = function () {
            wordCountValue.textContent = this.value;
            generatePassword();
        };

        includeUppercase.onchange = generatePassword;
        includeDigits.onchange = generatePassword;
        includeSpecial.onchange = generatePassword;
        capitalizeWords.onchange = generatePassword;

        async function generatePassword() {
            const formData = new FormData();
            if (passphraseToggle.checked) {
                formData.append('type', 'passphrase');
                formData.append('word_count', wordCountSlider.value);
                formData.append('capitalize', capitalizeWords.checked);
            } else {
                formData.append('length', lengthSlider.value);
                formData.append('include_uppercase', includeUppercase.checked);
                formData.append('include_digits', includeDigits.checked);
                formData.append('include_special', includeSpecial.checked);
            }

            const response = await fetch('/generate-password', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            scrambleAnimation(data.password);
        }

        function scrambleAnimation(finalPassword) {
            let scrambled = Array.from({ length: finalPassword.length }, () => getRandomCharacter());
            passwordInput.value = scrambled.join('');
            finalPassword.split('').forEach((char, index) => {
                let delay = Math.random() * (400 - 50) + 50;
                setTimeout(() => {
                    scrambled[index] = char;
                    passwordInput.value = scrambled.join('');
                }, delay * index);
            });
        }

        function getRandomCharacter() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:\'",.<>/?';
            return characters.charAt(Math.floor(Math.random() * characters.length));
        }

        function copyPassword() {
            passwordInput.select();
            document.execCommand('copy');
        }

        window.onload = generatePassword;
    </script>

</body>

</html>